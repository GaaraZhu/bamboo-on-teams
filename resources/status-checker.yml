StatusChecker:
  name: ${self:custom.aws.stepFunction.name}
  definition:
    StartAt: DelayTheChecking
    States:
      DelayTheChecking:
        Type: Wait
        Seconds: 5
        Next: CheckStatus

      CheckStatus:
        Type: Task
        Resource:
          Fn::GetAtt: [checkStatusFunc, Arn]
        ResultPath: $.result
        Retry:
          - ErrorEquals:
              - jobNotFinishedError
            IntervalSeconds: 10
            BackoffRate: 1
            MaxAttempts: 2
        Catch:
          - ErrorEquals:
              - jobNotFinishedError
            ResultPath: $.error
            Next: NotifyResult
        Next: NotifyResult

      NotifyResult:
        Type: Task
        Resource:
          Fn::GetAtt: [notifyStatusFunc, Arn]
        Next: FinalEndState

      FinalEndState:
        Type: Pass
        End: true
